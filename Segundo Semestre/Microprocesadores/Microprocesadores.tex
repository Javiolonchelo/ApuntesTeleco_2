\documentclass[a4paper]{book}

\input{../../Archivos comunes/Preamble_Lua.tex} % Se incluye el preámbulo

% Título y portada
\title{\Huge Microprocesadores\\\vspace*{5pt}
\Large Apuntes de clase}
\author{Javier Rodrigo López \thanks{Correo electrónico: \href{mailto:javiolonchelo@gmail.com}{\texttt{javiolonchelo@gmail.com}}}} 
\date{\today}

%%% INICIO DEL DOCUMENTO %%%
\begin{document}

\setlength{\wpYoffset}{-2 cm}
\ThisCenterWallPaper{0.5}{./Imágenes/Bouguereau.jpg}
\maketitle

% Marca de agua
\AddToShipoutPictureFG{
	\begin{tikzpicture}[overlay,remember picture]
		\path (current page.south west) -- (current page.north east)
		node[midway,scale=8,color=lightgray,sloped,opacity=0.05] {Javier Rodrigo López};
	\end{tikzpicture}
}

% Logotipos UPM y ETSIST
\begin{figure}[t!]
	\centering
	\begin{subfigure}[b]{0.65\linewidth}
		\includegraphics[width=\linewidth]{../../Archivos comunes/upm_logo.png}
	\end{subfigure}
	\begin{subfigure}[b]{0.25\linewidth}
		\includegraphics[width=\linewidth]{../../Archivos comunes/etsist_logo.png}
	\end{subfigure}
\end{figure}

% Introducción
\newpage
\phantomsection
\addcontentsline{toc}{section}{Introducción}
\section*{Introducción}
Imagen de la portada: \textsl{Dante y Virgilio en el infierno}, por William-Adolphe Bouguereau.

Contenidos

5 Temas

\begin{itemize}
	\item Tema 0. Presentación (S1)
	\item Tema 1. Memorias semiconductoras (S1-S2 + S5)
	\item Tema 2. Microprocesadores (S2-S4)
	\item Tema 3. Micro (S6-S8)
	\item Resolución de problemas (S5, S15-S16)
\end{itemize}

Laboratorio - Aula D8211

Calendario

Profesorado
Manuel César Rdoríguez Lacruz (coordinador) - Temas 0 a 3
Miguel Chavarrías Lapastora - Tema 4

Recursos
\begin{itemize}
	\item The definitive guide to the ARM Cortex-M0 and Cortex-M0+ processors. Newnes
	\item Fast and effective embedded systems design. Applying the ARM mbed. Newnes.
	\item Embedded C Coding Standard. Barrgroup. IMPORTANTE, TODO EL CÓDIGO TIENE QUE TENER ESTE ESTILO

	      Excepto que las llaves de apertura van al final de la línea y la anchura de las indentaciones es de 2 espacios, en lugar de 4 como marca el libro.
\end{itemize}

Evaluación

Laboratorio (asistencia obligatoria)
\[ L = 0.05P_1 + 0.125P_2 + 0.125P_3 +0.2P_4 + 0.2L_1 + 0.3L_2 (*)\]

Hay varias modalidades de examen de laboratorio. Si se aprueba el laboratorio, solo se realiza el examen de teoría.

Teoría

Calificación final
Hay que sacar como mínimo un 4.5 en teoría y laboratorio para poder hacer media.

Requisitos

\begin{itemize}
	\item Hay que saber manejar MUY BIEN el hexadecimal y el binario natural.
	\item Hay que saber hacer divisores resistivos y circuitos de polarización de diodos y transistores (bipolares y FET)
	\item Comprender los subsistemas combinacionales y secuenciales (incluyendo autómatas) y aplicar sus técnicas de análisis y síntesis.
	\item Codificar programas en lenguaje C/C++
	\item Aplicar las herramientas de \textit{debugging} y demás
\end{itemize}

Asistencia obligatoria.

Materiales para el laboratorio
\begin{itemize}
	\item Una o dos \textit{protoboards}.
	\item Una placa STM Nucleo-l432kc. Hay que desoldar un par de jumpers. Buscar en la foto.
	\item Un modelo concreto de sensor ultrasónico.
	\item Cable de pares 1 metro (evitar los cables Duppont).
	\item 3 LED
	\item 3 micropulsadores
	\item 2 displays de 7 segmentos
	\item 1 LDR
	\item Para el resto de los componentes, mirar las listas de las prácticas, en Moodle.
\end{itemize}

\subsubsection{Lista de tareas} \vspace{\parskip}
\begin{enumerate}
	\item Ir instalando los programas para las prácticas.
	\item Descargar libros de bibliografía.
	\item Comprar material.
\end{enumerate}
\newpage

% Índice (TOC)
\setlength{\parskip}{0em}
\tableofcontents
\setlength{\parskip}{0.5em}

%%% INICIO DE LOS APUNTES %%%
\chapter{Memorias semiconductoras}
\section{Bancos de registros}
Un \textbf{registro} es un circuito secuencial paralelo-paralelo que permite almacenar un dato de varios bits.

Un \textbf{banco de registros} es una colección de registros. Se usan para almacenar varios datos de varios bits.

Al hablar de registros, es normal denominarlos \textbf{direcciones}. Entonces, en un banco de registros de 8 registros, cuando se quiera escribir un dato en el quinto registro se dirá que se quiere acceder a la dirección 5.

\subsection{Estructura}

Vamos a ver la estructura con un ejemplo. Un registro de cuatro datos de 8 bits usando registros de 8 bits. Una salida de 8 bits. Por lo tanto, necesitaremos un multiplexor de 4 a 1 con su correspondiente entrada de selección \verb|A_RD| (dirección de lectura). Además, se necesita una entrada de habilitación \verb|A_WR| (dirección de escritura) que, usando un decodificador, permitirá la habilitación de los registros, teniendo este mismo otra entrada de habilitación denominada \verb|WRn| (escritura, a nivel bajo).

\subsection{Chip select}

Chip Select (CSn, a nivel bajo) es un enable del banco de registros. Se añade una puerta AND con entradas CSn y WRn, la salida será WEn, que es la entrada de habilitación del decodificador.

\subsection{Doble puerto}

El \textbf{doble puerto} de lectura consiste en añadir otra salida, con su correspondiente multiplexor y entrada de selección de registro de lectura.

\subsection{Bus bidireccional}

El bus bidireccional es un único bus que hace las funciones de bus de entrada y bus de salida. Se necesita el \textbf{buffer de tres estados} (falta describir este componente).

\subsection{Output enable}

El output enable (OEn) es una entrada que proporciona permiso para obtener la lectura por el bus de datos.

\subsection{Capacidad y organización}

En esta asignatura, los datos van a ser denominados \textbf{palabras}.
\begin{itemize}
	\item $n \equiv $ número de registros
	\item $p \equiv $ anchura del bus de direcciones $\left( n=2^p \right)$
	\item $q \equiv $ tamaño en bits de cada palabra
	\item Organización: $n\times q$. Ejemplo: \verb|32x64|
	\item Capacidad: $n\cdot q$. Ejemplo: $32 \cdot 64 = 2048$ palabras
\end{itemize}

\subsection{Símbolo}

\subsection{Cronograma de funcionamiento}

FALTA AÑADIR IMÁGENES

\section{Memorias semiconductoras}

Son registros con algunas diferencias.
\begin{itemize}
	\item No emplean flip-flops para almacenar la información. Permiten almacenar mucha más información que los bancos de registros.
	\item Muchas veces son asíncronas, careciendo de reloj y de puerto de inicialización síncrona.
\end{itemize}

Sin embargo, comparten bastantes características:
\begin{itemize}
	\item Los conceptos de organización y capacidad son idénticos.
	\item Existen variantes con buses separados, doble puerto...
\end{itemize}

\subsubsection{Pasos a seguir para escribir una palabra en la memoria}
\begin{enumerate}
	\item Poner la dirección a la que quieres acceder.
	\item Poner el dato que quieres escribir.
	\item Habilitar la memoria.
	\item Decirle que NO vas a leer. Esto es obligatorio.
	\item Siempre tiene que haber un flanco de subida para escribir el dato, porque las memorias son asíncronas. La escritura sucede durante el flanco.
\end{enumerate}

\subsection{Características}

\subsubsection{Permanencia}

Una vez haya sido almacenada la información, su contenido no se puede alterar (solo lectura/permanentes vs. lectura/escritura)

\subsubsection{Volatilidad}

Si una memoria es volátil, la información se pierde al retirar la alimentación.

\subsubsection{Acceso}

El tiempo de acceso a los datos es puede ser dependiente o independiente en la memoria o no. Son las memorias de acceso aleatorio y de acceso secuencial, respectivamente.

\subsubsection{Dinámicas o estáticas}
La información puede perderse al poco tiemo de ser almacenada y necesitas un refresco (\textit{refresh}), o no. Son las memorias dinámicas y las memorias estáticas, respectivamente.

\subsection{Clasificación de los sistemas de almacenamiento}

\begin{figure}[t!]
	\centering
	\includegraphics[width=\linewidth]{./Imágenes/Memories.png}
\end{figure}

CAMBIAR ESTA LISTA POR UN ESQUEMA

\subsection{Parámetros}
\subsubsection{}
Cantidad de información (bits) que puede almacenar.


Tiempo que transcurre desde que se pide un dato a la memoria hasta que esta lo entrega.

\begin{itemize}
	\item \textbf{Tiempo de acceso (ta)}
	\item \textbf{Capacidad de almacenamiento}
	\item \textbf{Coste por bit:} Precio de la memoria dividido entre su capacidad en bits
\end{itemize}

Estas tres características están relacionadas.
A menor ta, menor capacidad y mayor coste.

\subsubsection{Tiempos importantes}


Control por RW


\subsection{Cronogramas de funcionamiento}

\subsection{Mapas de memoria}

En un sistema puede haber diversos tipos de memoria.

Por ejemplo, un ordenador puede necesitar memoria no volátil de lectura y escritura (flash) para almacenar un programa, y a la vez necesitar una memoria volátil estática (SRAM) para acceso de datos a alta velocidad.

Un \textbf{mapa de memoria} es una representación esuqemática de qué tipo (chips o módulos)

\section{Mapas de memoria}

baia la cabaia

\subsubsection{Ampliación del tamaño de palabra}

En ocasiones, se puede desear una memoria de cierta longitud de palabra, pero se dispone de chips de palabra menor. En tal caso, la palabra deseada se divide en fragmentos del tamaño de palabra que tengan los chips disponibles.

\verb|int(main){Holaa}|

\chapter{Microprocesadores}

Existen problemas que no pueden ser resueltos mediante sistemas combinacionales.
\section{Concepto de algoritmo}

\section{Sistemas secuenciales con memoria. Definición de microprocesador}

\section{Elemntos internos de un microprocesador}

\section{Arquitectura de tres buses}

\section{Ejemplos de codificación de instrucciones}

\section{Evolución de los microprocesadores}

\section{Modelos de programación y set de instrucciones}

\section{Pila}

\section{Característica de las arquitecturas}

\section{Entorno de programación para sistemas empotrados}

\chapter{Procesador ARM Cortex-M0}

\section{Historia de ARM}

\section{Arquitectura ARM Cortex-M0}

\subsection{Características principales de la arquitectura}

\subsection{Organización de memoria}

\subsection{Modelo de programación}

\subsection{Set de instrucciones}

\subsection{Reset del procesador}

\subsection{Tamaños de datos}

\section{Microcontroladores basados en arquitecturas ARM Cortex-M}

\subsection{NXP LPC1768}

\subsection{STM ST32L432KC}

\chapter{Técnicas de I/O e interrupciones}

\section{Entrada/Salida}

Si se requiere que un procesador se comunique con el exterior, este lo hará a través de los \textbf{periféricos}.

Los \textbf{microcontroladores} son los chips que contienen procesador, memoria y periféricos.

La descripción de la funcionalidad del periférico, de cada uno de los registros de su interfaz y sus direcciones en el mapa de memoria

Modelo hardware

La descripción de las características:
\begin{itemize}
	\item Eléctricas (niveles lógicos, corrientes...)
	\item Dinámicas (capacidades, tiempos, consumos...)
\end{itemize}

\section{GPIO}

mbed GPIO: \verb|DigitalIn|
Entrada digital de un bit

Constructores:

\verb|DigitalIn(PinName pin)|

\verb|DigitalIn(PinName pin, PinMode mode)|

Otras opciones:

\verb|void mode(PinMode mode)|

\section{Interrupciones}

\subsection{Polling e interrupciones}

\subsection{Esquemas hardware para la gestión de interrupciones}

\subsection{Esquemas hardware para la gestión de interrupciones}

\subsection{\texorpdfstring{Conceptos de enmascaramiento, vector, prioridad, latencia,\\ anidamiento y excepción}{Conceptos de enmascaramiento, vector, prioridad, latencia, anidamiento y excepción}}

\subsection{Sleep}

\subsection{Particularización para la arquitectura Cortex-M0}

\section{Temporizadores}

\section{PWM}

\section{ADC y DAC}

\section{Sistemas controlados por eventos}

\subsection{Concepto de sistema reactivo y de evento}

\subsection{Máquinas de estados finitos controladas por eventos}

\subsubsection{Eventos y mensajes}

\subsubsection{Estados y variables extendidas, guardas}

\subsubsection{Codificación en C}

\subsubsection{Ejemplo de aplicación completa}

\section{Comunicaciones serie asíncronas}

\subsection{Concepto}

\subsection{Parámetros y variantes}

\subsection{Interfaz físico}

\subsection{UART y transceiver}

\subsection{Programación}

\chapter{Laboratorio}

\section{Lenguaje de ensamble}

\section{Entrada/Salida}

\section{Temporizadores e interrupciones}

\section{Diseño de aplicación de mediana complejidad}

%%% FIN DE LOS APUNTES %%%

%%% BIBLIOGRAFÍA %%%
% Por defecto, se encuentra desactivada. Esto disminuye el tiempo de procesado. Se puede activar cuando se vaya a exportar el PDF definitivo

%\newpage
%\phantomsection
%\label{sec:bibliografia_final}
%\renewcommand{\refname}{Bibliografía}
%\addcontentsline{toc}{section}{Bibliografía}
%\bibliography{bibliografia} % Nombre del archivo (sin ".bib")
%\bibliographystyle{bababbrv} 

\end{document}